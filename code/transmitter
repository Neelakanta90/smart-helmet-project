#include <ESP8266WiFi.h>
#include <Wire.h>
#include <Adafruit_MPU6050.h>
#include <Adafruit_Sensor.h>
#include <WiFiClient.h>
#include <ESP8266HTTPClient.h>

const char* ssid = "Your_WiFi_Name";
const char* password = "Your_WiFi_Password";
const char* serverURL = "http://<RECEIVER_IP>/data"; // replace with receiver ESP IP

const int mq3Pin = A0;
int alcoholThreshold = 400; // adjust after testing

Adafruit_MPU6050 mpu;
sensors_event_t a, g, temp;

void setup() {
  Serial.begin(115200);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) delay(500);

  if (!mpu.begin()) {
    Serial.println("MPU6050 not found");
    while (1);
  }
}

void loop() {
  int alcoholValue = analogRead(mq3Pin);
  mpu.getEvent(&a, &g, &temp);
  float accel = abs(a.acceleration.x) + abs(a.acceleration.y) + abs(a.acceleration.z);

  bool alcoholDetected = (alcoholValue > alcoholThreshold);
  bool fallDetected = (accel < 5); // tweak threshold after testing

  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverURL);
    http.addHeader("Content-Type", "application/x-www-form-urlencoded");

    String postData = "alcohol=" + String(alcoholDetected) + "&fall=" + String(fallDetected);
    http.POST(postData);
    http.end();
  }

  delay(1000);
}
